import { RatingResult, SunshineRatingSystem } from '../utils/SunshineRatingSystem';

/**
 * æ—¥ç…§è¯„åˆ†æ˜¾ç¤ºç»„ä»¶
 * ç”¨äºå±•ç¤ºæ—¥ç…§ç­‰çº§ã€æ˜Ÿçº§å’Œå»ºè®®
 */
@Component
export struct SunshineRatingCard {
  @Prop ratingResult: RatingResult;
  
  build() {
    Column() {
      // è¯„åˆ†æ ‡é¢˜
      Text('æ—¥ç…§è´¨é‡è¯„ä¼°')
        .fontSize(18)
        .fontWeight(FontWeight.Bold)
        .margin({ bottom: 15 })
      
      // è¯„åˆ†ç­‰çº§å’Œåˆ†æ•°
      Row() {
        // ç­‰çº§æ ‡ç­¾
        Text(this.ratingResult.rating)
          .fontSize(24)
          .fontWeight(FontWeight.Bold)
          .fontColor(this.ratingResult.color)
          .margin({ right: 15 })
        
        // åˆ†æ•°åœ†ç¯
        Column() {
          Text(`${this.ratingResult.score}`)
            .fontSize(32)
            .fontWeight(FontWeight.Bold)
            .fontColor(this.ratingResult.color)
          
          Text('åˆ†')
            .fontSize(14)
            .fontColor($r('app.color.text_secondary'))
        }
        .justifyContent(FlexAlign.Center)
        .width(80)
        .height(80)
        .border({
          width: 4,
          color: this.ratingResult.color,
          radius: 40
        })
      }
      .width('100%')
      .justifyContent(FlexAlign.SpaceAround)
      .margin({ bottom: 15 })
      
      // æ˜Ÿçº§æ˜¾ç¤º
      Text(SunshineRatingSystem.getStarsDisplay(this.ratingResult.stars))
        .fontSize(24)
        .margin({ bottom: 10 })
      
      // è¯„åˆ†è¯´æ˜
      Text(SunshineRatingSystem.getScoreDescription(this.ratingResult.score))
        .fontSize(14)
        .fontColor($r('app.color.text_secondary'))
        .margin({ bottom: 15 })
      
      // åˆ†éš”çº¿
      Divider()
        .margin({ top: 10, bottom: 10 })
      
      // ç®€çŸ­æ€»ç»“
      Row() {
        Text('ğŸ“‹')
          .fontSize(16)
          .margin({ right: 8 })
        
        Text(this.ratingResult.summary)
          .fontSize(14)
          .fontWeight(FontWeight.Medium)
          .layoutWeight(1)
          .maxLines(2)
          .textOverflow({ overflow: TextOverflow.Ellipsis })
      }
      .width('100%')
      .margin({ bottom: 15 })
      .alignItems(VerticalAlign.Top)
      
      // å›½æ ‡ç¬¦åˆæ€§
      Row() {
        Text(this.ratingResult.meetsStandard ? 'âœ…' : 'âŒ')
          .fontSize(16)
          .margin({ right: 8 })
        
        Text(this.ratingResult.meetsStandard ? 'ç¬¦åˆå›½å®¶æ—¥ç…§æ ‡å‡†' : 'ä¸ç¬¦åˆå›½å®¶æ—¥ç…§æ ‡å‡†')
          .fontSize(14)
          .fontColor(this.ratingResult.meetsStandard ? '#4CAF50' : '#F44336')
          .fontWeight(FontWeight.Medium)
      }
      .width('100%')
      .margin({ bottom: 15 })
      
      // å»ºè®®åˆ—è¡¨
      if (this.ratingResult.suggestions.length > 0) {
        Column() {
          Text('ğŸ’¡ ä¸“ä¸šå»ºè®®')
            .fontSize(14)
            .fontWeight(FontWeight.Bold)
            .margin({ bottom: 8 })
            .alignSelf(ItemAlign.Start)
          
          ForEach(this.ratingResult.suggestions, (suggestion: string, index: number) => {
            Row() {
              Text(`${index + 1}.`)
                .fontSize(13)
                .fontColor($r('app.color.text_secondary'))
                .margin({ right: 5 })
              
              Text(suggestion)
                .fontSize(13)
                .fontColor($r('app.color.text_secondary'))
                .layoutWeight(1)
                .maxLines(3)
                .textOverflow({ overflow: TextOverflow.Ellipsis })
            }
            .width('100%')
            .margin({ bottom: 5 })
            .alignItems(VerticalAlign.Top)
          })
        }
        .width('100%')
        .padding(12)
        .backgroundColor('#F5F5F5')
        .borderRadius(8)
      }
    }
    .width('100%')
    .padding(20)
    .backgroundColor(Color.White)
    .borderRadius(12)
    .shadow({
      radius: 8,
      color: '#00000015',
      offsetX: 0,
      offsetY: 2
    })
  }
}

/**
 * ç®€æ´ç‰ˆè¯„åˆ†æ˜¾ç¤ºç»„ä»¶(ç”¨äºåˆ—è¡¨)
 */
@Component
export struct SunshineRatingBadge {
  @Prop ratingResult: RatingResult;
  
  build() {
    Row() {
      // è¯„çº§æ ‡ç­¾
      Text(this.ratingResult.rating)
        .fontSize(14)
        .fontWeight(FontWeight.Bold)
        .fontColor(Color.White)
        .padding({ left: 8, right: 8, top: 4, bottom: 4 })
        .backgroundColor(this.ratingResult.color)
        .borderRadius(4)
        .margin({ right: 8 })
      
      // æ˜Ÿçº§
      Text(SunshineRatingSystem.getStarsDisplay(this.ratingResult.stars))
        .fontSize(14)
        .margin({ right: 8 })
      
      // åˆ†æ•°
      Text(`${this.ratingResult.score}åˆ†`)
        .fontSize(14)
        .fontColor(this.ratingResult.color)
        .fontWeight(FontWeight.Medium)
    }
    .alignItems(VerticalAlign.Center)
  }
}
